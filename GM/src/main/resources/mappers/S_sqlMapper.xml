<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.spring.gm.persistence.S_DAO" >

	<select id="getMessageArticleCnt" resultType="int">
		SELECT COUNT(*) as cnt FROM message WHERE receiver=#{receiver} AND del=0 AND message_num=1
	</select>
	
	<select id="getMessageArticleList" parameterType="java.util.Map" resultType="com.spring.gm.vo.MessageVO">
		<![CDATA[
			SELECT * FROM(SELECT num, message_num, sender, receiver, subject, content, state, sentDate, receiveDate, del ,rownum rNum FROM (SELECT * FROM message WHERE receiver = #{receiver} AND del = 0 AND message_num = 1 ORDER BY message_num ASC)) WHERE rNum >= #{start} AND rNum <= #{end}
		]]>
	</select>	
	
	<insert id="sendMessage" parameterType="com.spring.gm.vo.MessageVO">
		INSERT INTO Message (num, message_num, sender, receiver, subject, content, state, sentDate, receiveDate,  del) 
		VALUES(seq_message.nextval, #{message_num}, #{sender}, #{receiver}, #{subject}, #{content}, #{state}, #{sentDate}, #{receiveDate}, #{del}) 
	</insert>
	
	<insert id="sendMessageData" parameterType="com.spring.gm.vo.MessageVO">
		INSERT INTO Message (num, message_num, sender, receiver, subject, content, state, sentDate, receiveDate,  del) 
		VALUES(seq_message.nextval, #{message_num}, #{sender}, #{receiver}, #{subject}, #{content}, #{state}, #{sentDate}, #{receiveDate}, #{del}) 
	</insert>
	
	
	
	<select id="sendMessageArticleCnt" resultType="int">
		SELECT COUNT(*) as cnt FROM message WHERE sender=#{sendId} AND del=0 AND message_num=2
	</select>

	<select id="sendMessageArticleList" parameterType="java.util.Map" resultType="com.spring.gm.vo.MessageVO">
		<![CDATA[
			SELECT * FROM(SELECT num, message_num, sender, receiver, subject, content, state, sentDate, receiveDate, del ,rownum rNum FROM (SELECT * FROM message WHERE sender = #{sendId} AND del = 0 AND message_num = 2 ORDER BY message_num ASC)) WHERE rNum >= #{start} AND rNum <= #{end}
		]]>
	</select>
	
	<update id="delBoard" parameterType="com.spring.gm.vo.MessageVO">
		<![CDATA[
			UPDATE BOARDLIST SET message_num = 4 WHERE num = #{num}
		]]>
	</update>
	
	<select id="getGarbageCnt" resultType="int">
		SELECT COUNT(*) as cnt FROM message WHERE receiver=#{strId} AND del=0 AND message_num=4
	</select>
	
	<select id="getGarbageList" parameterType="java.util.Map" resultType="com.spring.gm.vo.MessageVO">
		<![CDATA[
			SELECT * FROM(SELECT num, message_num, sender, receiver, subject, content, state, sentDate, receiveDate, del ,rownum rNum FROM (SELECT * FROM message WHERE receiver = #{receiver} AND del = 0 AND message_num = 4 ORDER BY message_num ASC)) WHERE rNum >= #{start} AND rNum <= #{end}
		]]>
	</select>	

</mapper>