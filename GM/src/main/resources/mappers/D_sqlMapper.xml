<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.spring.gm.persistence.D_DAO" >

	<insert id="insertBoards" parameterType="com.spring.gm.vo.BoardsVO">
		INSERT INTO BOARDS (num, groupId, b_name, anon, del) 
		VALUES(boards_seq.nextval, #{groupId}, #{b_name}, #{anon}, #{del}) 
	</insert>
	
	<select id="getBoardsArticleCnt" resultType="int">
		SELECT COUNT(*) as cnt FROM BOARDS
	</select>
	
	<select id="getBoardsArticleList" parameterType="java.util.Map" resultType="com.spring.gm.vo.BoardsVO">
		<![CDATA[
			SELECT * FROM(SELECT num, groupId, b_name, anon, del, rownum rNum FROM (SELECT * FROM BOARDS ORDER BY num ASC)) WHERE rNum >= #{start} AND rNum <= #{end}
		]]>
	</select>
	
	<update id="updateBoards" parameterType="com.spring.gm.vo.BoardsVO">
		UPDATE BOARDS b_name = #{b_name}, anon = #{anon}, groupId = #{groupId} WHERE num = #{num}
	</update>
	
	<update id="deleteBoards" parameterType="com.spring.gm.vo.BoardsVO">
		UPDATE BOARDS del = #{del} WHERE num = #{num}
	</update>
	
	<select id="getBoardArticleCnt" resultType="int">
		SELECT COUNT(*) as cnt FROM BOARDLIST
	</select>
	
	 
	<select id="getBoardArticleList" parameterType="java.util.Map" resultType="com.spring.gm.vo.BoardListVO">
		<![CDATA[
		SELECT * 
		FROM (SELECT boardnum, num, writer, subject, content, re_num, readcnt, ref, ref_step, ref_level, reg_date, del, rownum as rNum
			FROM (SELECT * FROM BOARDLIST WHERE num=#{num} ORDER BY ref DESC, ref_step ASC)
			)
			WHERE rNum >= #{start} AND rNum <= #{end}
		]]>
	</select>
	
	<insert id="insertBoard" parameterType="com.spring.gm.vo.BoardListVO">
		INSERT INTO BOARDLIST (boardnum, num, writer, subject, content, readcnt, re_num, ref, ref_step, ref_level, reg_date, del) 
		VALUES(board_seq.nextval, #{num}, #{writer}, #{subject}, #{content}, #{readcnt}, #{re_num}, #{ref}, #{ref_step}, #{ref_level}, #{reg_date}, #{del}) 
	</insert>
	
	<select id="getArticle" parameterType="int" resultType="com.spring.gm.vo.BoardListVO">
		SELECT * FROM BOARDLIST WHERE boardnum = #{boardnum}
	</select>
	
	<update id="addReadCnt" parameterType="int">
		UPDATE BOARDLIST SET readCnt = readCnt + 1 WHERE boardnum = #{boardnum}
	</update>
	 		
</mapper>